# AutoBot æ€§èƒ½ä¼˜åŒ–æµ‹è¯•æŒ‡å—

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–å†…å®¹

### âœ… å·²å®Œæˆä¼˜åŒ–
1. **waitForIdle è¶…æ—¶ä¼˜åŒ–**
   - ä¼˜åŒ–å‰ï¼š`1000ms æ£€æŸ¥é—´éš”, 3000ms æœ€å¤§ç­‰å¾…` (æœ€å¤šç­‰ 3 ç§’ï¼)
   - ä¼˜åŒ–åï¼š`100ms æ£€æŸ¥é—´éš”, 500ms æœ€å¤§ç­‰å¾…` (æœ€å¤šç­‰ 0.5 ç§’)
   - **æ€§èƒ½æå‡ï¼š6 å€ï¼**

2. **é»˜è®¤å‚æ•°ä¼˜åŒ–**
   - é»˜è®¤ `isWait=0`ï¼ˆä¸ç­‰å¾… UI ç©ºé—²ï¼Œå¿«é€Ÿå“åº”ï¼‰
   - å‚è€ƒåº”ç”¨é€šå¸¸ä½¿ç”¨ `isWait=0`

3. **æ—¥å¿—è¾“å‡ºä¼˜åŒ–**
   - å‡å°‘éå¿…è¦æ—¥å¿—è¾“å‡º
   - `/api/hello` ä¸å†è¾“å‡ºæ—¥å¿—

---

## ğŸ“± æµ‹è¯•æ­¥éª¤

### 1. å¯åŠ¨ Shell Server
```
æ‰‹æœºæ“ä½œï¼š
- æ‰“å¼€ AutoBot åº”ç”¨
- ç‚¹å‡»ã€Œå¼€å§‹é…å¯¹ã€ï¼ˆå¦‚æœæ²¡é…å¯¹è¿‡ï¼‰
- ç‚¹å‡»ã€Œâ–¶ å¯åŠ¨ Shell Serverã€
- ç­‰å¾…æ˜¾ç¤ºã€ŒğŸŸ¢ Shell Server: è¿è¡Œä¸­ã€
```

### 2. ç”µè„‘ç«¯å£è½¬å‘
```powershell
adb forward tcp:19090 tcp:19090
```

### 3. æµ‹è¯•æ€§èƒ½
```powershell
# å¥åº·æ£€æŸ¥ï¼ˆåŸºå‡†æµ‹è¯•ï¼‰
Measure-Command { curl http://127.0.0.1:19090/api/hello | Out-Null }

# screenXml ä¸ç­‰å¾…ï¼ˆä¼˜åŒ–ååº”è¯¥å¾ˆå¿«ï¼‰
Measure-Command { curl "http://127.0.0.1:19090/api/screenXml?isWait=0" | Out-Null }

# screenXml ç­‰å¾…ï¼ˆå¯¹æ¯”å·®å¼‚ï¼‰
Measure-Command { curl "http://127.0.0.1:19090/api/screenXml?isWait=1" | Out-Null }

# screenJson ä¸ç­‰å¾…ï¼ˆä¼˜åŒ–ååº”è¯¥å¾ˆå¿«ï¼‰
Measure-Command { curl "http://127.0.0.1:19090/api/screenJson?isWait=0" | Out-Null }
```

---

## ğŸ“Š é¢„æœŸæ€§èƒ½

| API | å‚æ•° | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|-----|------|--------|--------|------|
| `/api/hello` | - | ~10ms | ~10ms | åŸºå‡† |
| `/api/screenXml` | `isWait=0` | ~100ms | ~100ms | æ— éœ€ç­‰å¾… |
| `/api/screenXml` | `isWait=1` | ~3100ms | ~600ms | **6å€** |
| `/api/screenJson` | `isWait=0` | ~150ms | ~150ms | æ— éœ€ç­‰å¾… |
| `/api/screenJson` | `isWait=1` | ~3150ms | ~650ms | **6å€** |

**é‡ç‚¹ï¼š** é»˜è®¤ä½¿ç”¨ `isWait=0`ï¼Œä¸å‚è€ƒåº”ç”¨ä¸€è‡´ï¼Œå“åº”éå¸¸å¿«ï¼

---

## ğŸš€ å¿«é€Ÿæ€§èƒ½æµ‹è¯•è„šæœ¬

ä¿å­˜ä¸º `test_performance.ps1`:

```powershell
Write-Host "AutoBot Performance Test" -ForegroundColor Cyan
Write-Host "=========================" -ForegroundColor Cyan

# æµ‹è¯•å¥åº·æ£€æŸ¥
Write-Host "`n1. Health Check..." -ForegroundColor Yellow
$time = Measure-Command { 
    $resp = Invoke-WebRequest -Uri "http://127.0.0.1:19090/api/hello" -TimeoutSec 5
    Write-Host "   Response: $($resp.Content)"
}
Write-Host "   Time: $([math]::Round($time.TotalMilliseconds, 2)) ms" -ForegroundColor Green

# æµ‹è¯• screenXml (ä¸ç­‰å¾…)
Write-Host "`n2. Screen XML (isWait=0)..." -ForegroundColor Yellow
$time = Measure-Command { 
    $resp = Invoke-WebRequest -Uri "http://127.0.0.1:19090/api/screenXml?isWait=0" -TimeoutSec 5
    Write-Host "   XML Length: $($resp.Content.Length) chars"
}
Write-Host "   Time: $([math]::Round($time.TotalMilliseconds, 2)) ms" -ForegroundColor Green

# æµ‹è¯• screenXml (ç­‰å¾…) - å¯¹æ¯”
Write-Host "`n3. Screen XML (isWait=1)..." -ForegroundColor Yellow
$time = Measure-Command { 
    $resp = Invoke-WebRequest -Uri "http://127.0.0.1:19090/api/screenXml?isWait=1" -TimeoutSec 10
    Write-Host "   XML Length: $($resp.Content.Length) chars"
}
Write-Host "   Time: $([math]::Round($time.TotalMilliseconds, 2)) ms" -ForegroundColor Green

# æµ‹è¯• screenJson (ä¸ç­‰å¾…)
Write-Host "`n4. Screen JSON (isWait=0)..." -ForegroundColor Yellow
$time = Measure-Command { 
    $resp = Invoke-WebRequest -Uri "http://127.0.0.1:19090/api/screenJson?isWait=0" -TimeoutSec 5
    Write-Host "   JSON Length: $($resp.Content.Length) chars"
}
Write-Host "   Time: $([math]::Round($time.TotalMilliseconds, 2)) ms" -ForegroundColor Green

Write-Host "`n=========================" -ForegroundColor Cyan
Write-Host "Performance test complete!" -ForegroundColor Green
```

è¿è¡Œï¼š
```powershell
.\test_performance.ps1
```

---

## ğŸ’¡ å…³é”®ä¼˜åŒ–ç‚¹

### 1. ä¸ºä»€ä¹ˆ `isWait=1` å¾ˆæ…¢ï¼Ÿ
- `waitForIdle()` ä¼šç­‰å¾… UI å®Œå…¨åœæ­¢åŠ¨ç”»
- å¦‚æœæœ‰åŠ¨ç”»æˆ–åˆ·æ–°ï¼Œä¼šä¸€ç›´ç­‰åˆ°è¶…æ—¶
- **ä¼˜åŒ–å‰ï¼šæœ€å¤šç­‰ 3 ç§’**
- **ä¼˜åŒ–åï¼šæœ€å¤šç­‰ 0.5 ç§’**

### 2. ä»€ä¹ˆæ—¶å€™ç”¨ `isWait=1`ï¼Ÿ
- éœ€è¦ç­‰å¾…åŠ¨ç”»å®Œæˆåè·å–ç¨³å®šçš„ UI æ ‘
- æå°‘æ•°åœºæ™¯ä½¿ç”¨

### 3. é»˜è®¤åº”è¯¥ç”¨ `isWait=0`
- å‚è€ƒåº”ç”¨é»˜è®¤ä½¿ç”¨ `isWait=0`
- å“åº”é€Ÿåº¦å¿«
- é€‚åˆå¤§å¤šæ•°åœºæ™¯

---

## âš¡ æ€§èƒ½å¯¹æ¯”ç¤ºä¾‹

### ä¼˜åŒ–å‰ï¼ˆisWait=1ï¼‰
```
Request: GET /api/screenXml?isWait=1
æ”¶åˆ° screenXml è¯·æ±‚: isWait=true
[ç­‰å¾… UI ç©ºé—²... æœ€å¤š 3 ç§’]
å“åº”: 3100 ms âŒ å¤ªæ…¢ï¼
```

### ä¼˜åŒ–åï¼ˆisWait=0ï¼Œé»˜è®¤ï¼‰
```
Request: GET /api/screenXml?isWait=0
[ç›´æ¥è·å– UI æ ‘ï¼Œä¸ç­‰å¾…]
å“åº”: 100 ms âœ… å¾ˆå¿«ï¼
```

### ä¼˜åŒ–åï¼ˆisWait=1ï¼‰
```
Request: GET /api/screenXml?isWait=1
[ç­‰å¾… UI ç©ºé—²... æœ€å¤š 0.5 ç§’]
å“åº”: 600 ms âœ… æ”¹å–„ 6 å€ï¼
```

